<h1> Лабораторная работа №4 "Симуляция "Казино и гуси"" </h1>
<hr>
<p>Программа симулирует несколько шагов системы казино, в которой игроки пытаются выиграть гусь-коины(GC), а гуси - забрать у них деньги.</p>

<p>Поддерживает следующие команды:</p>
<ul>
    <li> python -m src.main -x 20 -s 1 -b - запускает симуляцию(настройки по умолчанию: 20 шагов обычной игры на случайном сиде) </li>
    <li> python -m unittest discover -s tests -p "test_*.py" - запускает тесты </li>
</ul>

<p2> Структура </p2>
<pre>
    .
    ├── lab4
    │   ├── src/                               # Папка с кодом
    │       ├── __init__.py                    #
    │       ├── collections/                   # Коллекции
    │           ├── goose_balance.py           # Класс коллекции балансов гусей
    │           ├── goose_collection.py        # Класс коллекции гусей
    │           ├── player_balance.py          # Класс коллекции балансов игроков
    │           ├── player_collection.py       # Класс коллекции игроков
    │       ├── entities/                      #
    │           ├── base_classes.py            # Базовые классы игроков и гусей
    │           ├── casino.py                  # Класс казино
    │           ├── geese.py                   # Производные классы гусей
    │           ├── players.py                 # Производные классы игроков
    │       ├── sounds                         # Звуки(крик гусей)
    │       ├── constants.py                   # Константы(имена гусей и игроков)
    │       ├── logger.py                      # Логер
    │       ├── simulation.py                  # Функция симуляции
    │       ├── config.py                      # Конфигурация для логера
    │       ├── main.py                        # Точка входа
    │   ├── tests/                             # Юниттесты
    │   ├── .gitignore                         # Файл, который не даёт мусорить в гите
    │   ├── .pre-commit-config.yaml            # Конфигурация любимого pre-commit
    |   ├── pyproject.toml                     # Информация по проекту(для системы)
    |   ├── README.md                          # Документация
    │   ├── requirements.txt                   # Зависимости проекта
    |   ├── uv.lock                            # зависимости проекта
</pre>

<h2> Алгоритмы </h2>

<h3> Класс Goose </h3>
    <p>Самый обычный гусь. Он может лишь красть у игроков и кричать без эффекта. Кража проходит успешно с вероятностью 60±20% (зависит от класса обворовываемого игрока), и в случае успеха отнимает у игрока 5-15 GC. Гуси могут объединиться в стаю. Стая обладает всеми деньгами слагаемых, увеличенной громкостью крика и всеми методами обоих слагаемых. Методы гусей, включая методы наследников, имеют равную вероятность срабатывания.</p>

<h3> Класс WarGoose </h3>
    <p>Злобный гусь, закалённый во множестве сражений с игроками. Обладает уникальной способностью "Атака", которая крадёт больше GC, чем обычная кража.</p>

<h3> Класс HonkGoose </h3>
    <p>Этот гусь мечтал петь в хоре, но из-за чрезмерной громкости его голоса его мечта не исполнилась. Впрочем, он нашёл своё призвание в сражениях с игроками в казино. Его особый навык "Супер-крик" настолько пугает игроков, что те теряют монеты в течение нескольких ходов(5 GC/ход, 4 хода).</p>

<h3> Класс BankerGoose </h3>
    <p>Единственный гусь, прошедший курсы финансовой грамотности для начинающих, поэтому обладает альтернативным способом заработка. Он может дать игроку кредит в размере 20 GC на 5 ходов, после чего требует обратно 22 GC. Если у игрока не хватает денег, гусь увозит его в лес, забирая оставшиеся деньги.</p>

<h3> Класс CommanderGoose </h3>
    <p>Матёрый гусь, прошедший множество гусино-игроковых войн. Имеет большой авторитет среди остальных гусей. Командор использует это, чтобы направить всю мощь гусиной армии на 1 игрока.</p>

<h3> Класс BouncerGoose </h3>
    <p>Гусь со скверным характером, из-за чего его недолюбливают даже гуси. Однако его немалая сила оказалась очень полезной на игорных полях сражений. Если ему не понравится какой-то игрок, тот отправится домой, а оставшиеся деньги вышибала присваивает себе.</p>

<h3> Класс Player </h3>
    <p>Самый обычный игрок, пришедший из МАИ после тяжёлого учебного дня расслабиться в казино. Может поставить 10 GC и выиграть 30 GC(обычный выигрыш) или 60 GC(джекпот).</p>

<h3> Класс LuckPlayer </h3>
    <p>Шулер с ловкими руками, выигрывающий за раз больше, чем кто-либо другой. Его навыки и наблюдательность позволили перенять технику воровства гусей, и теперь этот игрок может воровать у гусей. Но он плохо защищается от нападок гусей, из-за чего кражи и атаки на него случаются чаще.</p>

<h3> Класс DefenderPlayer </h3>
    <p>В детстве этот игрок мечтал стать рыцарем, защищающим людей от разных опасностей. В некоторой степени его мечта исполнилась, и теперь он защищает игроков от нападок гусей, из-за чего последние ничего не могут сделать с защищаемым игроком. Защита длится 3 хода. Кроме того, гусям сложнее своровать у этого игрока, но этот игрок выигрывает меньше среднестатистического игрока.</p>

<h3> Класс GooseBalance </h3>
    <p>Словарная коллекция для хранения балансов гусей. Содержит методы __setitem__(__setitem__ классического словаря с прикрученным логером), sum(считает сумму балансов гусей) и update_balance, принимающий коллекцию гусей как аргумент и обновляющий балансы гусей, при необходимости удаляя несуществующие записи(изменения логируются).</p>

<h3> Класс PlayerBalance </h3>
    <p>Словарная коллекция для хранения балансов игроков. Содержит методы __setitem__(__setitem__ классического словаря с прикрученным логером), sum(считает сумму балансов игроков) и update_balance, принимающий коллекцию игроков как аргумент и обновляющий балансы игроков, при необходимости удаляя несуществующие записи(изменения логируются).</p>

<h3> Класс GooseCollection </h3>
    <p>Списковая коллекция для хранения гусей. Содержит методы append(добавление гуся в коллекцию), remove(удаление гуся из коллекции), __len__(длина коллекции), __getitem__(индексация и срезы), __iter__(итерация), random(взятие случайного гуся) и set_target(установка общей цели для атаки, если её нет - отменяет текущую цель гусей).</p>

<h3> Класс PlayerCollection </h3>
    <p>Списковая коллекция для хранения игроков. Содержит методы append(добавление игрока в коллекцию), remove(удаление игрока из коллекции), __len__(длина коллекции), __getitem__(индексация и срезы), __iter__(итерация), random(взятие случайного игрока), honk_update(уменьшает всем игрокам, у кого есть деньги и нет защиты, баланс на 5 GC), update_credit(заставляет игроков выплачивать кредиты, если пришло время(должник отдаёт кредитору 22 GC или уезжает в лес, лишаясь оставшихся денег)) и update_protect(обновляет статус защиты на игроках, убирая её или уменьшая счётчик ходов).</p>

<h3> Класс Casino </h3>
    <p>Собственно казино. Содержит методы registr_player(регистрация нового игрока случайного класса), registr_goose(регистрация нового гуся случайного класса), result(вычисляет команду победителей по балансам гусей и игроков) и iteration(выполняет 1 шаг симуляции). За 1 шаг симуляции происходят следующие вещи: у случайного игрока вызывается случайный метод, затем берётся случайный гусь, и вызываются его случайные методы от 1 до нескольких(каждое 2-ое имя добавляет 1 дополнительное действие(отсчёт от единицы)), при необходимости устанавливаются значения счётчиков ходов с супер-криком и атаки одной цели. Затем с шансом в 10% гуси могут объединиться в стаю. Стая называется именами гусей через пробел, балансы и громкость слагаемых, а также обладает всеми методами обоих слагаемых. В конце итерации происходит обработка долгих эффектов(влияние супер-крика, отмена цели спустя время, выплата кредитов и завершение защиты), а также обновление балансов.</p>

<h3> Функция run_simulation </h3>
    <p>Создаёт гусей и игроков в равном количестве: большая игра - от 20 до 30 штук, обычная - от 5 до 15. Затем проходит симуляция в n шагов(n по умолчанию равно 20). Затем подсчитывается результат</p>

<h2> Система логирования </h2>
    <p>В файле src/config.py хранится словарь конфигурации логера. Далее в модулях, где нужно логировать, импортируется экземпляр логера из src/logger.py. Логи сохраняются в файл debug.log, который периодически самоочищается при достижнении размера 3*5 МБ(удаляются файлы со старыми логами). Если файл debug.log отсутствует, создаётся новый, иначе логи записываются в существующий debug.log.</p>
